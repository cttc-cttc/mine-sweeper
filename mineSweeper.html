<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MineSweeper</title>
</head>
<style>
	#container{
		width: 600px;
		margin: 50px auto;
	}
	.content{
		display: flex;
		justify-content: center;
	}
    .area{
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    .innerContent{
    	width: 33%;
    	text-align: center;
    }
    #btnReset{
    	width: 100px;
    	height: 40px;
    	font-size: 20px;
    }
    button:hover{
    	cursor: pointer;
    }
    .text{
        font-size: 20px;
    }
    .btnLevel{
    	width: 180px;
        height: 30px;
        font-size: 17px;
    }
</style>
<body>

<div id="container">
	<div id="board" style="display:flex; flex-direction:column; align-items: center;"></div><br>
	<div class="content">
		<div class="innerContent">
			<button id="btnReset" onclick="reset()">reset</button>
		</div>
		<div class="innerContent">
			<span class="text">üí• : <span id="xCnt"></span> / <span id="xNum"></span></span>
		</div>
		<div class="innerContent">
			<span class="text" id="gameStatus"></span>
		</div>
	</div>
	<br>
	<div class="content">
		<button class="btnLevel" onclick="level(1)">level 1</button>&nbsp;
		<button class="btnLevel" onclick="level(2)">level 2</button>&nbsp;
		<button class="btnLevel" onclick="level(3)">level 3</button>
	</div>
</div>

<script>
	// x : ÏßÄÎ¢∞
	let board;
    let xNum = -1;
    let areaNum = -1;
    // Í≤åÏûÑÎ≥¥Îìú ÌÖåÏù¥Î∏î : row x col
    let row = -1;
    let col = -1;
    let width = -1;
    let height = -1;
    let fontSize = -1;
	window.onload = function() {
        board = document.getElementById('board');
        level(1);
		init();
        // Í∏∞Î≥∏Ï†ÅÏù∏ Ïö∞ÌÅ¥Î¶≠ Ïãú Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥Ï∞ΩÏù¥ Îú®Îäî Ïù¥Î≤§Ìä∏Î•º ÎßâÏùå
        window.oncontextmenu = function() {
        	return false;
        }
	}
    
    function init() {
    	let innerBoard = '';
    	for(let i=0; i<row; i++) {
    		innerBoard += '<div>';
    		for(let j=1; j<=col; j++) {
        		innerBoard += '<div class="area" id="a'+ (i*col+j) +'" ';
        		innerBoard += 'style="float:left; border:solid thin; width:'+width+'px; ';
        		innerBoard += 'height:'+height+'px; font-size:'+fontSize+'px;"></div>';
        	}
        	innerBoard += '</div>';
    	}
		board.innerHTML = innerBoard;
        areaNum = board.childElementCount * board.children[0].childElementCount;
        document.getElementById('xCnt').innerHTML = xNum;
        document.getElementById('xNum').innerHTML = xNum;
		let xArr = new Array();
		let isDup = false;
        
		for(let i=0; i<xNum; i++) {
			isDup = false;
			let xLoc = parseInt(Math.random()*areaNum + 1); // ÏßÄÎ¢∞ ÏúÑÏπò
			for(let j=0; j<xArr.length; j++) {
				if(xArr[j] == xLoc) {
					i--;
					isDup = true;
					break;
				}
			}
			if(!isDup)
				xArr.push(xLoc);
		}
        
        // board ÎÇ¥Î∂ÄÏùò Ï†ÑÏ≤¥ divÏóê Ï¥àÍ∏∞ ÏÜçÏÑ±Í∞íÏùÑ ÏÑ§Ï†ïÌïòÍ≥† ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏ ÏßÄÏ†ï
        for(let i=1; i<=areaNum; i++) {
        	let div = document.getElementById('a'+i);
            
            // Î®ºÏ†Ä x(ÏßÄÎ¢∞) ÏÜçÏÑ±Í∞íÏùÑ 0ÏúºÎ°ú Ï¥àÍ∏∞Ìôî ÌïòÍ≥†
            // ÌòÑÏû¨ ÏúÑÏπòÍ∞Ä xArrÏóê Ï†ÄÏû•Îêú ÏßÄÎ¢∞ ÏúÑÏπòÏôÄ ÎßûÏúºÎ©¥ x ÏÜçÏÑ±Í∞íÏùÑ 1Î°ú Ïû¨ÏÑ§Ï†ï
            // Í∑∏ ÌõÑ xArrÏùò ÏßÄÎ¢∞ ÏúÑÏπò ÏõêÏÜåÎ•º ÌïòÎÇò ÏÇ≠Ï†úÌï®
            div.setAttribute('x', 0);
            for(let j=0; j<xArr.length; j++) {
            	if(i == xArr[j]) {
                	div.setAttribute('x', 1);
                    xArr.splice(j, 1);
                    break;
                }
            }
            div.setAttribute('end', 0); // Í≤åÏûÑ ÌÅ¥Î¶¨Ïñ¥Î•º ÌåêÎ≥ÑÌï† Îïå ÏÇ¨Ïö©
            div.setAttribute('flag', 0); // ÍπÉÎ∞ú ÌëúÏãúÎ•º ÌåêÎ≥ÑÌï† Îïå ÏÇ¨Ïö©
            div.style.backgroundColor = 'white';
            div.innerHTML = '';
            document.getElementById('gameStatus').innerHTML = '';
        	div.addEventListener('click', leftClickEvent);
            div.addEventListener('mouseup', rightClickEvent);
            div.addEventListener('mouseover', hoverInEvent);
            div.addEventListener('mouseout', hoverOutEvent);
        }
    }
    
    function leftClickEvent() {
    	let div = event.target;
        // ÌÅ¥Î¶≠Ìïú Í≥≥Ïóê ÍπÉÎ∞ú ÌëúÏãúÍ∞Ä ÏûàÏúºÎ©¥ ÌÅ¥Î¶≠ Î∂àÍ∞Ä(Ïö∞ÌÅ¥Î¶≠ÏúºÎ°ú ÍπÉÎ∞ú Ìï¥Ï†úÌïòÎ©¥ ÌÅ¥Î¶≠ Í∞ÄÎä•)
        if(div.getAttribute('flag') == 1)
        	return;
        
        // Ìïú Î≤à Ï†ïÏÉÅ ÌÅ¥Î¶≠Îêú Í≥≥ÏùÄ Îçî Ïù¥ÏÉÅ ÌÅ¥Î¶≠ Î∂àÍ∞Ä
        div.removeEventListener('click', leftClickEvent);
        div.removeEventListener('mouseup', rightClickEvent);
        div.removeEventListener('mouseover', hoverInEvent);
        div.removeEventListener('mouseout', hoverOutEvent);
        
        // ÌÅ¥Î¶≠Ìïú ÏúÑÏπòÍ∞Ä ÏßÄÎ¢∞Ïùº Îïå
		if(div.getAttribute('x') == 1) {
			div.style.backgroundColor = '#751919'; // Ïñ¥ÎëêÏö¥ Îπ®Í∞ï
            div.style.setProperty('cursor', 'context-menu');
            removeEvent(); // ÏßÄÎ¢∞Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ Îßµ Ï†ÑÏ≤¥ Îçî Ïù¥ÏÉÅ ÌÅ¥Î¶≠ Î∂àÍ∞Ä(game over)
            // ÍπÉÎ∞ú ÌëúÏãúÌïú Í≥≥ÏùÑ Ï†úÏô∏Ìïú ÎÇ®ÏùÄ ÏßÄÎ¢∞Î•º Î™®Îëê Î≥¥Ïó¨Ï§å
            for(let i=1; i<=areaNum; i++) {
            	let content = document.getElementById('a'+i);
        		if(content.getAttribute('flag') == 0 && content.getAttribute('x') == 1)
                	content.innerHTML = 'üí•';
                // ÍπÉÎ∞ú ÌëúÏãúÎ•º ÌñàÏßÄÎßå ÏßÄÎ¢∞ ÏúÑÏπòÍ∞Ä ÏïÑÎãàÎ©¥ X ÌëúÏãú
                else if(content.getAttribute('flag') == 1 && content.getAttribute('x') == 0)
                	content.innerHTML = '‚ùå';
        	}
            document.getElementById('gameStatus').innerHTML = 'Game Over..';
		} else {
        	div.style.backgroundColor = '#A3B0A5'; // ÌöåÏÉâ
            div.style.setProperty('cursor', 'context-menu');
            div.setAttribute('end', 1);
        	let locArr = new Array(); // ÌòÑÏû¨ ÌÅ¥Î¶≠Ìïú Í≥≥ Í∏∞Ï§Ä ÏµúÎåÄ 8Î∞©Ìñ• ÏúÑÏπòÏùò divÎ•º Ï†ÄÏû•
        	let currLoc = Number(div.id.substring(1, div.id.length)); // idÏùò aÎ•º Î∫Ä Ïà´ÏûêÎßå
            let cnt = 0;
            // ‚Üñ
            let leftUp = currLoc-col-1;
            if(leftUp > 0 && currLoc%col != 1) {
            	locArr.push(document.getElementById('a'+ leftUp));
            	if(document.getElementById('a'+ leftUp).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üë
            let up = currLoc-col;
            if(up > 0) {
            	locArr.push(document.getElementById('a'+ up));
            	if(document.getElementById('a'+ up).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üó
            let rightUp = currLoc-col+1;
            if(rightUp > 0 && currLoc%col != 0) {
            	locArr.push(document.getElementById('a'+ rightUp));
            	if(document.getElementById('a'+ rightUp).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üê
            let left = currLoc-1;
            if(currLoc%col != 1) {
            	locArr.push(document.getElementById('a'+ left));
            	if(document.getElementById('a'+ left).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üí
            let right = currLoc+1;
            if(currLoc%col != 0) {
            	locArr.push(document.getElementById('a'+ right));
            	if(document.getElementById('a'+ right).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üô
            let leftDown = currLoc+col-1;
            if(leftDown < areaNum+1 && currLoc%col != 1) {
            	locArr.push(document.getElementById('a'+ leftDown));
            	if(document.getElementById('a'+ leftDown).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üì
            let down = currLoc+col;
            if(down < areaNum+1) {
            	locArr.push(document.getElementById('a'+ down));
            	if(document.getElementById('a'+ down).getAttribute('x') == 1)
                	cnt++;
            }
            // ‚Üò
            let rightDown = currLoc+col+1;
            if(rightDown < areaNum+1 && currLoc%col != 0) {
            	locArr.push(document.getElementById('a'+ rightDown));
            	if(document.getElementById('a'+ rightDown).getAttribute('x') == 1)
                	cnt++;
            }
            
            if(cnt != 0) {
        		div.innerHTML = cnt;
			} else { // Ï£ºÎ≥ÄÏóê ÏßÄÎ¢∞Í∞Ä ÏóÜÏúºÎ©¥ Ïù∏Ï†ëÌïú Ï£ºÎ≥Ä ÏßÄÎ¢∞Í∞úÏàòÍ∞Ä 0Ïù¥ ÏïÑÎãå ÏßÄÏó≠ÍπåÏßÄ ÌÅ¥Î¶≠ÏãúÌÇ¥
            	for(let i=0; i<locArr.length; i++) {
                	locArr[i].click();
                }
            }
            endCheck();
        } // 1st else
    }
    
    function rightClickEvent() {
    	// Î∏åÎùºÏö∞Ï†ÄÏóê Îî∞Î•∏ Í∏∞Î≥∏ Ïö∞ÌÅ¥Î¶≠ Ìò∏Ï∂úÍ∞í
    	let rClick = (event.which == 3) || (event.button == 2);
        let xCntSpan = document.getElementById('xCnt');
        if(rClick) {
            let div = event.target;
            if(div.getAttribute('flag') == 0) {
				div.innerHTML = 'üö©';
            	div.setAttribute('flag', 1);
                xCntSpan.innerHTML = Number(xCntSpan.innerHTML) - 1;
            } else {
                div.innerHTML = '';
            	div.setAttribute('flag', 0);
                xCntSpan.innerHTML = Number(xCntSpan.innerHTML) + 1; 
            }
            
        }
    }
    
    function hoverInEvent() {
    	let div = event.target;
        if(div.getAttribute('flag') != 1)
        	div.style.setProperty('cursor', 'pointer');
        div.style.setProperty('background-color', '#C0F5C7'); // Î∞ùÏùÄ ÎØºÌä∏ÏÉâ
    }
    
    function hoverOutEvent() {
    	let div = event.target;
        div.style.setProperty('cursor', 'context-menu');
        div.style.setProperty('background-color', 'white');
    }
    
    function removeEvent() {
    	for(let i=1; i<=areaNum; i++) {
        	let div = document.getElementById('a'+i);
        	div.removeEventListener('click', leftClickEvent);
            div.removeEventListener('mouseup', rightClickEvent);
            div.removeEventListener('mouseover', hoverInEvent);
			div.removeEventListener('mouseout', hoverOutEvent);
        }
    }
    
    function reset() {
    	init();
    }
    
    // ÏßÄÎ¢∞Í∞Ä ÏïÑÎãå ÏúÑÏπòÎ•º Îã§ Î∞ùÌûàÎ©¥ Í≤åÏûÑ Ï¢ÖÎ£å
    function endCheck() {
    	let cnt = 0;
    	for(let i=1; i<=areaNum; i++) {
            if(document.getElementById('a'+i).getAttribute('end') == 1) {
            	cnt++;
            }
        }
        if(cnt == areaNum - xNum) {
        	removeEvent();
            document.getElementById('gameStatus').innerHTML = 'Clear!';
            for(let i=1; i<=areaNum; i++) {
            	let div = document.getElementById('a'+i);
            	if(div.getAttribute('end') == 0) { // ÌÅ¥Î¶≠ÎêòÏßÄ ÏïäÏùÄ ÏúÑÏπòÎßå
            		div.style.backgroundColor = '#DCE7DD'; // Î∞ùÏùÄ ÌöåÏÉâ
            	}
        	}
        }
    }
    
    function level(lev) {
    	if(lev == 1)
            setLevelValue(5, 7, 5, 70, 70, 45);
        else if(lev == 2)
            setLevelValue(8, 10, 15, 50, 50, 35);
        else
            setLevelValue(11, 13, 25, 40, 40, 27);
    }
    
    function setLevelValue(rowVal, colVal, xNumVal, widthVal, heightVal, fontSizeVal) {
    	row = rowVal;
        col = colVal;
		xNum = xNumVal;
		width = widthVal;
		height = heightVal;
        fontSize = fontSizeVal;
		reset();
    }
</script>
</body>
</html>